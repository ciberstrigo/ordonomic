#!/usr/bin/env php
<?php

use Jegulnomic\Command\AbstractCommand;
use Jegulnomic\Systems\Command;
use Jegulnomic\Systems\ContainerProvider;

const ENTRYPOINT_DIR = __DIR__;

require_once ENTRYPOINT_DIR . '/../src/Systems/Function/bootstrap.php';

$className = '\Jegulnomic\Command\\' . $argv[1];
$methodName = $argv[2];

if (!class_exists($className)) {
    Command::output('No such command class: ' . $className);
    die;
}

if (!method_exists($className, $methodName)) {
    Command::output('No such command method: ' . $methodName);
    die;
}

$container = ContainerProvider::getContainer();
/** @var AbstractCommand $instance */
$instance = $container->get($className);

if (!class_exists($className)) {
    Command::output('No such command class: ' . $className);
    die;
}

if (!method_exists($className, $methodName)) {
    Command::output('No such command method: ' . $methodName);
    die;
}

$container = ContainerProvider::getContainer();
/** @var AbstractCommand $instance */
$instance = $container->get($className);
$instance->setArguments(array_slice($argv, 3))->$methodName();